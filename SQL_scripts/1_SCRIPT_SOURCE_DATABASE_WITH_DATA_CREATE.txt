/*THIS SCRIPT CREATES SOURCE DATABASE AND FILLS IT WITH DATA*/


/*drop database if already exists*/
DROP DATABASE if exists CopenhagenMetro;

/*create source database*/
CREATE DATABASE CopenhagenMetro;


		

/*create table where info about IoT sensors is stored*/
use CopenhagenMetro
Create table source_Sensor
(
Sensor_ID int,
name nvarchar(255),
PRIMARY KEY(Sensor_ID)
);

insert into source_Sensor values (1,'Sensor_CO_1');		
insert into source_Sensor values (2,'Sensor_Humidity_1');		
insert into source_Sensor values (3,'Sensor_Temperature_1');		
insert into source_Sensor values (4,'Sensor_NumberOfPassangers_1');		
				





/*create table where environmental data from IoT is stored*/


Create table source_EnvironmentValues
(
ID int IDENTITY(1,1),
CO2_value float,
CO2_Sensor_ID int,
humidity_value float,
humidity_Sensor_ID int,
temperature_value float,
temperature_Sensor_ID int,
numberOfPassengers_value int,
numberOfPassengers_Sensor_ID int,
dateAndTime DATETIME,


FOREIGN KEY (numberOfPassengers_Sensor_ID) REFERENCES source_Sensor(Sensor_ID),
FOREIGN KEY (humidity_Sensor_ID) REFERENCES source_Sensor(Sensor_ID),
FOREIGN KEY (CO2_Sensor_ID) REFERENCES source_Sensor(Sensor_ID),
FOREIGN KEY (temperature_Sensor_ID) REFERENCES source_Sensor(Sensor_ID)
);
/*insert dummy data*/		
insert into source_EnvironmentValues (CO2_value,CO2_Sensor_ID,humidity_value,humidity_Sensor_ID,					
	temperature_value,temperature_Sensor_ID,numberOfPassengers_value,numberOfPassengers_Sensor_ID,				
	dateAndTime) values (50.2,1,20.1,3,33.3,6,25,8,'2020-11-10 22:11:00');				
insert into source_EnvironmentValues (CO2_value,CO2_Sensor_ID,humidity_value,humidity_Sensor_ID,					
	temperature_value,temperature_Sensor_ID,numberOfPassengers_value,numberOfPassengers_Sensor_ID,				
	dateAndTime) values (59.2,1,22.1,3,35.3,6,28,8,'2020-11-10 23:12:00');				
insert into source_EnvironmentValues (CO2_value,CO2_Sensor_ID,humidity_value,humidity_Sensor_ID,					
	temperature_value,temperature_Sensor_ID,numberOfPassengers_value,numberOfPassengers_Sensor_ID,				
	dateAndTime) values (69.2,1,28.1,3,38.3,6,21,8,'2020-11-11 21:12:00');				
insert into source_EnvironmentValues (CO2_value,CO2_Sensor_ID,humidity_value,humidity_Sensor_ID,					
	temperature_value,temperature_Sensor_ID,numberOfPassengers_value,numberOfPassengers_Sensor_ID,				
	dateAndTime) values (67.7,2,38.1,4,38.3,5,21,7,'2020-09-10 21:12:00');				
insert into source_EnvironmentValues (CO2_value,CO2_Sensor_ID,humidity_value,humidity_Sensor_ID,					
	temperature_value,temperature_Sensor_ID,numberOfPassengers_value,numberOfPassengers_Sensor_ID,				
	dateAndTime) values (47.7,2,36.1,4,58.3,5,27,7,'2020-09-10 20:12:00');				






/*create table which shows metro stations*/
Create table source_MetroStation
(
MetroStation_ID int,
name nvarchar(255),
PRIMARY KEY(MetroStation_ID)
);
/*insert dummy data*/
insert into source_MetroStation values (1,'DummyStationName_1');
insert into source_MetroStation values (2,'DummyStationName_2');
insert into source_MetroStation values (3,'DummyStationName_3');



/*create table which shows IoT sensors and in which metro station they were/are in time*/
Create table source_MetroStation_Sensor
(
Sensor_ID int,
MetroStation_ID int,
DateFrom DATETIME,
DateTo DATETIME,
PRIMARY KEY(Sensor_ID, DateFrom),
FOREIGN KEY (Sensor_ID) REFERENCES source_Sensor(Sensor_ID)
);
/*insert dummy data*/
insert into source_MetroStation_Sensor (Sensor_ID,MetroStation_ID,DateFrom,DateTo) values (1,1,'2019-01-01','2999-12-31');
insert into source_MetroStation_Sensor (Sensor_ID,MetroStation_ID,DateFrom,DateTo) values (3,1,'2019-01-01','2999-12-31');
insert into source_MetroStation_Sensor (Sensor_ID,MetroStation_ID,DateFrom,DateTo) values (6,1,'2019-01-01','2999-12-31');
insert into source_MetroStation_Sensor (Sensor_ID,MetroStation_ID,DateFrom,DateTo) values (8,1,'2019-01-01','2999-12-31');
insert into source_MetroStation_Sensor (Sensor_ID,MetroStation_ID,DateFrom,DateTo) values (2,2,'2019-01-01','2999-12-31');
insert into source_MetroStation_Sensor (Sensor_ID,MetroStation_ID,DateFrom,DateTo) values (4,2,'2019-01-01','2999-12-31');
insert into source_MetroStation_Sensor (Sensor_ID,MetroStation_ID,DateFrom,DateTo) values (5,2,'2019-01-01','2999-12-31');
insert into source_MetroStation_Sensor (Sensor_ID,MetroStation_ID,DateFrom,DateTo) values (7,2,'2019-01-01','2999-12-31');



/*create table which shows devices (shafts, ventilators)*/
Create table source_Device
(
Device_ID int,
name nvarchar(255),
PRIMARY KEY(Device_ID)
);
/*insert dummy data*/
insert into source_Device values (1,'Ventilator_1');
insert into source_Device values (2,'Ventilator_2');
insert into source_Device values (3,'Heating_1');
insert into source_Device values (4,'Heating_2');


/*create table which shows devices and in which metro station they were/are in time*/
Create table source_MetroStation_Device
(
Device_ID int,
MetroStation_ID int,
DateFrom DATETIME,
DateTo DATETIME,
PRIMARY KEY(Device_ID, DateFrom),
FOREIGN KEY (Device_ID) REFERENCES source_Device(Device_ID)
);
/*insert dummy data*/
insert into source_MetroStation_Device (Device_ID,MetroStation_ID,DateFrom) values (1,1,'2019-01-01');
insert into source_MetroStation_Device (Device_ID,MetroStation_ID,DateFrom) values (3,1,'2019-01-01');
insert into source_MetroStation_Device (Device_ID,MetroStation_ID,DateFrom) values (2,2,'2019-01-01');
insert into source_MetroStation_Device (Device_ID,MetroStation_ID,DateFrom) values (4,2,'2019-01-01');



/*create table which actions that can be performed on devices (shafts, ventilators)*/
Create table source_Action
(
Action_ID int,
Name nvarchar(255),
Description nvarchar(255),
PRIMARY KEY(Action_ID)
);
/*insert dummy data*/
insert into source_Action values (1,'Set_Ventilator','open ventilator to specific angle');
insert into source_Action values (2,'Set_Heating','set heating to specific temperature');



/*create table which shows actions and their values and on which devices they were perfomed in time*/
Create table source_Action_Device
(
id int IDENTITY(1,1),
Device_ID int,
Action_ID int,
valueSetInDevice float,
DateAndTIme DATETIME,
FOREIGN KEY (Device_ID) REFERENCES source_Device(Device_ID),
FOREIGN KEY (Action_ID) REFERENCES source_Action(Action_ID)
);
/*insert dummy data*/
insert into source_Action_Device (Device_ID,Action_ID,valueSetInDevice,DateAndTime) values (1,1,'20.2','2021-01-10 22:11:00');
insert into source_Action_Device (Device_ID,Action_ID,valueSetInDevice,DateAndTime) values (1,1,'20.2','2021-02-01 20:15:00');
insert into source_Action_Device (Device_ID,Action_ID,valueSetInDevice,DateAndTime) values (1,1,'20.2','2021-01-01 22:11:00');
insert into source_Action_Device (Device_ID,Action_ID,valueSetInDevice,DateAndTime) values (2,1,'10.1','2021-01-02 21:11:00');
insert into source_Action_Device (Device_ID,Action_ID,valueSetInDevice,DateAndTime) values (3,2,'20.2','2021-01-01 13:11:00');
insert into source_Action_Device (Device_ID,Action_ID,valueSetInDevice,DateAndTime) values (3,2,'25.2','2021-01-01 14:11:00');
insert into source_Action_Device (Device_ID,Action_ID,valueSetInDevice,DateAndTime) values (4,2,'10.1','2021-01-02 10:08:00');
insert into source_Action_Device (Device_ID,Action_ID,valueSetInDevice,DateAndTime) values (4,2,'15.1','2021-02-02 12:08:00');

